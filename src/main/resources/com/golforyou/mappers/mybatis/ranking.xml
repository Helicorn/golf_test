<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="rank">
	<!-- 랭킹 수 -->
	<select id="rank_count" resultType="java.lang.Integer">
		select count(*) from ranking
	</select>
	
	<!-- 랭킹 수2 -->
	<select id="rank_count2" resultType="int">
		select count(*) from ranking where r_province=#{r_province}
	</select>
	
	<!-- 랭킹 점수순으로 id정렬 -->
	<select id="rank_id" resultType="String">
		select r_id from ranking order by r_sum asc
	</select>
	
	<!-- 랭킹 점수순으로 점수정렬 -->
	<select id="rank_point" resultType="int">
		select r_sum from ranking order by r_sum asc
	</select>
	
	<!-- 랭킹 점수순으로 최대비거리정렬 -->
	<select id="rank_range" resultType="int">
		select r_maxrange from ranking order by r_sum asc <!-- ranking에 r_maxrange 컬럼 다시 추가해야함 -->
	</select>
	
	<!-- 랭킹 점수순으로 주소지정렬 -->
	<select id="rank_prov" resultType="String">
		select r_province from ranking order by r_sum asc
	</select>
	
	<!-- 로그인한 회원의 점수 -->
	<select id="rank_loginpoint" resultType="int">
		select r_sum from ranking where r_id=#{r_id}
	</select>

	<!-- 총합 점수 업데이트 -->
	<update id="rank_editAvg">
		update ranking set r_sum=r_sum+#{s_sumscore},r_maxrange=#{s_range} where r_id=#{s_id}
	</update>
	
	<!-- 회원가입과 동시에 랭킹레코드 발생 -->
	<insert id="rank_insert">
		insert into ranking(r_no,r_id,r_sum) values(rno_seq.nextval,#{r_id},9999)
	</insert>
	
	<!-- r_sum의 초기값 9999를 0으로 리셋 -->
	<update id="rank_reset">
		update ranking set r_sum=0 where r_id=#{s_id}
	</update>
</mapper>